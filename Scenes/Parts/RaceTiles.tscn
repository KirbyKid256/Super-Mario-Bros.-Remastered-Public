[gd_scene load_steps=26 format=3 uid="uid://cq5mo03ew7wjc"]

[ext_resource type="PackedScene" uid="uid://dciqpg4a7jtjm" path="res://Scenes/Prefabs/Blocks/BooRaceBlocks/BooOnOffSwitchAlt.tscn" id="2_8jj2v"]
[ext_resource type="PackedScene" uid="uid://eoo4cjsp5xu4" path="res://Scenes/Prefabs/Blocks/BooRaceBlocks/TimedBooBlockAlt.tscn" id="4_2ixhy"]
[ext_resource type="PackedScene" uid="uid://by6ndsjhlkmbt" path="res://Scenes/Prefabs/Blocks/BooRaceBlocks/BooOnOffBlock.tscn" id="7_cqi2u"]
[ext_resource type="Script" uid="uid://bi5u8yi6y2ex1" path="res://Scripts/Parts/RaceTiles.gd" id="8_cm7a7"]
[ext_resource type="PackedScene" uid="uid://5ua3p0lfl1bf" path="res://Scenes/Prefabs/Blocks/BooRaceBlocks/BooOnOffSwitch.tscn" id="8_ue7ie"]
[ext_resource type="PackedScene" uid="uid://c1xle3fplnxtr" path="res://Scenes/Prefabs/Blocks/BooRaceBlocks/BooOnOffBlueBlock.tscn" id="9_bv0hg"]
[ext_resource type="PackedScene" uid="uid://dgq7enviy1qhw" path="res://Scenes/Prefabs/Blocks/BooRaceBlocks/TimedBooBlock.tscn" id="10_l3bm6"]
[ext_resource type="PackedScene" uid="uid://d2ainv86lt68a" path="res://Scenes/Prefabs/Blocks/SwitchSpikeBlock.tscn" id="14_xw0jq"]
[ext_resource type="PackedScene" uid="uid://0q874wkbxcrr" path="res://Scenes/Prefabs/Blocks/SwitchSpikeBlockAlt.tscn" id="19_lt7u0"]
[ext_resource type="Texture2D" uid="uid://dwkcm4q32drtf" path="res://Assets/Sprites/Blocks/OnOffConveyorBelt.png" id="30_ohmg6"]
[ext_resource type="Script" uid="uid://73oviwf6bbys" path="res://Scripts/Classes/Components/TilesetTextureSetter.gd" id="32_4vbic"]
[ext_resource type="Script" uid="uid://cbal8ms2oe1ik" path="res://Scripts/Classes/Components/ResourceSetterNew.gd" id="34_av6qi"]
[ext_resource type="JSON" path="res://Assets/Sprites/Blocks/OnOffConveyor.json" id="39_7udf7"]

[sub_resource type="TileMapPattern" id="TileMapPattern_b6qiv"]
tile_data = PackedInt32Array(0, 524288, 0, 1, 589824, 0)

[sub_resource type="TileMapPattern" id="TileMapPattern_d4nyf"]
tile_data = PackedInt32Array(0, 524288, 1, 1, 589824, 1)

[sub_resource type="TileMapPattern" id="TileMapPattern_ls3wh"]
tile_data = PackedInt32Array(0, 524288, 2, 1, 589824, 2)

[sub_resource type="TileMapPattern" id="TileMapPattern_vt0hv"]
tile_data = PackedInt32Array(0, 524288, 3, 1, 589824, 3)

[sub_resource type="TileMapPattern" id="TileMapPattern_xj38k"]
tile_data = PackedInt32Array(0, 524288, 4, 1, 589824, 4)

[sub_resource type="TileMapPattern" id="TileMapPattern_o5705"]
tile_data = PackedInt32Array(0, 524288, 5, 1, 589824, 5)

[sub_resource type="TileMapPattern" id="TileMapPattern_ra18v"]
tile_data = PackedInt32Array(0, 524288, 6, 1, 589824, 6)

[sub_resource type="TileMapPattern" id="TileMapPattern_7cpm5"]
tile_data = PackedInt32Array(0, 524288, 7, 1, 589824, 7)

[sub_resource type="TileSetScenesCollectionSource" id="TileSetScenesCollectionSource_cm7a7"]
scenes/0/scene = ExtResource("8_ue7ie")
scenes/1/scene = ExtResource("2_8jj2v")
scenes/2/scene = ExtResource("10_l3bm6")
scenes/3/scene = ExtResource("4_2ixhy")
scenes/4/scene = ExtResource("7_cqi2u")
scenes/5/scene = ExtResource("9_bv0hg")
scenes/6/scene = ExtResource("14_xw0jq")
scenes/7/scene = ExtResource("19_lt7u0")

[sub_resource type="TileSetAtlasSource" id="TileSetAtlasSource_rrb2x"]
texture = ExtResource("30_ohmg6")
0:1/animation_speed = 30.0
0:1/animation_frame_0/duration = 1.0
0:1/animation_frame_1/duration = 1.0
0:1/animation_frame_2/duration = 1.0
0:1/animation_frame_3/duration = 1.0
0:1/0 = 0
0:1/0/physics_layer_0/linear_velocity = Vector2(-100, 0)
0:1/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)
0:1/0/metadata/_better_terrain = {
0: [16],
8: [16],
&"type": 16
}
0:2/animation_speed = 30.0
0:2/animation_frame_0/duration = 1.0
0:2/animation_frame_1/duration = 1.0
0:2/animation_frame_2/duration = 1.0
0:2/animation_frame_3/duration = 1.0
0:2/0 = 0
0:2/0/physics_layer_0/linear_velocity = Vector2(-100, 0)
0:2/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)
0:2/0/metadata/_better_terrain = {
8: [16],
&"type": 16
}
0:3/animation_speed = 30.0
0:3/animation_frame_0/duration = 1.0
0:3/animation_frame_1/duration = 1.0
0:3/animation_frame_2/duration = 1.0
0:3/animation_frame_3/duration = 1.0
0:3/0 = 0
0:3/0/physics_layer_0/linear_velocity = Vector2(100, 0)
0:3/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)
0:3/0/metadata/_better_terrain = {
0: [15],
&"type": 15
}
0:4/animation_speed = 30.0
0:4/animation_frame_0/duration = 1.0
0:4/animation_frame_1/duration = 1.0
0:4/animation_frame_2/duration = 1.0
0:4/animation_frame_3/duration = 1.0
0:4/0 = 0
0:4/0/physics_layer_0/linear_velocity = Vector2(100, 0)
0:4/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)
0:4/0/metadata/_better_terrain = {
0: [15],
8: [15],
&"type": 15
}
0:5/animation_speed = 30.0
0:5/animation_frame_0/duration = 1.0
0:5/animation_frame_1/duration = 1.0
0:5/animation_frame_2/duration = 1.0
0:5/animation_frame_3/duration = 1.0
0:5/0 = 0
0:5/0/physics_layer_0/linear_velocity = Vector2(100, 0)
0:5/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)
0:5/0/metadata/_better_terrain = {
8: [15],
&"type": 15
}
0:0/animation_speed = 30.0
0:0/animation_frame_0/duration = 1.0
0:0/animation_frame_1/duration = 1.0
0:0/animation_frame_2/duration = 1.0
0:0/animation_frame_3/duration = 1.0
0:0/0 = 0
0:0/0/physics_layer_0/linear_velocity = Vector2(-100, 0)
0:0/0/physics_layer_0/polygon_0/points = PackedVector2Array(-8, -8, 8, -8, 8, 8, -8, 8)
0:0/0/metadata/_better_terrain = {
0: [16],
&"type": 16
}

[sub_resource type="TileSet" id="TileSet_2ixhy"]
physics_layer_0/collision_layer = 2
physics_layer_0/collision_mask = 0
physics_layer_1/collision_layer = 64
physics_layer_1/collision_mask = 0
physics_layer_2/collision_layer = 128
physics_layer_2/collision_mask = 0
physics_layer_3/collision_layer = 256
physics_layer_3/collision_mask = 0
terrain_set_0/mode = 0
terrain_set_0/terrain_0/name = "Ground"
terrain_set_0/terrain_0/color = Color(0.5, 0.34375, 0.25, 1)
custom_data_layer_0/name = "OneWay"
custom_data_layer_0/type = 1
sources/0 = SubResource("TileSetScenesCollectionSource_cm7a7")
sources/1 = SubResource("TileSetAtlasSource_rrb2x")
pattern_0 = SubResource("TileMapPattern_b6qiv")
pattern_1 = SubResource("TileMapPattern_d4nyf")
pattern_2 = SubResource("TileMapPattern_ls3wh")
pattern_3 = SubResource("TileMapPattern_vt0hv")
pattern_4 = SubResource("TileMapPattern_xj38k")
pattern_5 = SubResource("TileMapPattern_o5705")
pattern_6 = SubResource("TileMapPattern_ra18v")
pattern_7 = SubResource("TileMapPattern_7cpm5")
metadata/_better_terrain = {
&"decoration": ["Decoration", Color(0.411765, 0.411765, 0.411765, 1), 3, [], {
&"path": "res://addons/better-terrain/icons/Decoration.svg"
}],
&"terrains": [["Ground", Color(0.499202, 0.933234, 0.473421, 1), 0, [17], {
&"coord": Vector2i(0, 3),
&"source_id": 0
}], ["SemiSolidA", Color(0.150473, 0.622493, 0.163743, 1), 0, [], {
&"path": ""
}], ["SemiSolidB", Color(0.875206, 0.89824, 0.445845, 1), 0, [], {
&"path": ""
}], ["TreeTop", Color(0.350251, 0.629116, 0.220607, 1), 0, [], {
&"path": ""
}], ["TreeBase", Color(0.879333, 0.761061, 0.594793, 1), 0, [], {
&"path": ""
}], ["Mushroom1", Color(0.517795, 0.876808, 0.540343, 1), 0, [], {
&"path": ""
}], ["Mushroom2", Color(0.623916, 0.324154, 0.620467, 1), 0, [], {
&"path": ""
}], ["Mushroom3", Color(0.0669944, 0.519591, 0.629746, 1), 0, [], {
&"path": ""
}], ["MushroomStem", Color(0.152017, 0.89977, 0.899866, 1), 0, [], {
&"path": ""
}], ["Water", Color(0.850961, 0.432139, 0.0841909, 1), 0, [], {
&"path": ""
}], ["Lava", Color(0.525599, 0.814885, 0.951678, 1), 0, [], {
&"path": ""
}], ["Poison", Color(0.260543, 0.167703, 0.601375, 1), 0, [], {
&"path": ""
}], ["Water2", Color(0.750773, 0.173298, 0.524227, 1), 0, [], {
&"path": ""
}], ["LeftConveyor", Color(0.51717, 0.337706, 0.910935, 1), 0, [], {
&"path": ""
}], ["RightConveyor", Color(0.61981, 0.975715, 0.136069, 1), 0, [], {
&"path": ""
}], ["OnOffConveyorB", Color(0.6255541, 0.5606077, 0.33833745, 1), 0, [], {
&"path": ""
}], ["OnOffConveyorR", Color(0.6458518, 0.49463975, 0.4241487, 1), 0, [], {
&"path": ""
}], ["Terrain", Color(0.54969203, 0.636939, 0.09403645, 1), 2, [], {
&"path": ""
}], ["SteepSlopeTL", Color(0.0027723156, 0.6224138, 0.13507082, 1), 0, [17], {
&"path": ""
}], ["SteepSlopeTR", Color(0.8638197, 0.23310995, 0.7271575, 1), 0, [17], {
&"path": ""
}], ["SteepSlopeBL", Color(0.21475314, 0.70974267, 0.15490618, 1), 0, [17], {
&"path": ""
}], ["SteepSlopeBR", Color(0.15159814, 0.61903995, 0.7452761, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeTL1", Color(0.6734451, 0.37050995, 0.6657021, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeTL2", Color(0.4760528, 0.1926865, 0.6703332, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeTR1", Color(0.6203271, 0.32173568, 0.2934855, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeTR2", Color(0.9271983, 0.5493484, 0.7319542, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeBL1", Color(0.32389325, 0.60938317, 0.21854156, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeBL2", Color(0.4086242, 0.5336439, 0.62485975, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeBR1", Color(0.740724, 0.6740337, 0.35465655, 1), 0, [17], {
&"path": ""
}], ["GentleSlopeBR2", Color(0.9705163, 0.8691093, 0.07167579, 1), 0, [17], {
&"path": ""
}], ["BoundaryTiles", Color(0.46449652, 0.74355936, 0.7307845, 1), 2, [], {
&"path": ""
}]],
&"version": "0.2"
}

[sub_resource type="GDScript" id="GDScript_vt0hv"]
script/source = "extends Node

@export var invert := false

var active := false

@onready var tile_map: TileMapLayer = owner

func _ready() -> void:
	await get_tree().physics_frame
	if is_instance_valid(Global.level_editor):
		Global.level_editor.editor_start.connect(on_toggled)

func on_switch_hit() -> void:
	active = !active
	update_tiles()

func update_tiles() -> void:
	for i in tile_map.get_used_cells_by_id(1):
		var y_coord = tile_map.get_cell_atlas_coords(i)
		if y_coord.y > 2:
			tile_map.set_cell(i, 1, y_coord - Vector2i(0, 3))
		elif y_coord.y <= 2:
			tile_map.set_cell(i, 1, y_coord + Vector2i(0, 3))


func on_toggled() -> void:
	if active:
		active = false
		update_tiles()
"

[node name="RaceTiles" type="TileMapLayer" groups=["RaceBlocks"]]
z_index = -1
tile_set = SubResource("TileSet_2ixhy")
physics_quadrant_size = 2
script = ExtResource("8_cm7a7")

[node name="OnOffConveyorTextureSetter" type="Node" parent="." node_paths=PackedStringArray("tile_map")]
script = ExtResource("32_4vbic")
tile_map = NodePath("..")
texture = ExtResource("30_ohmg6")
atlas_id = 1

[node name="ResourceSetterNew" type="Node" parent="OnOffConveyorTextureSetter" node_paths=PackedStringArray("node_to_affect")]
script = ExtResource("34_av6qi")
node_to_affect = NodePath("..")
property_name = "texture"
mode = 1
resource_json = ExtResource("39_7udf7")
metadata/_custom_type_script = "uid://cbal8ms2oe1ik"

[node name="OnOffConveyorHandler" type="Node" parent="." groups=["BooBlocks"]]
script = SubResource("GDScript_vt0hv")

[connection signal="child_entered_tree" from="." to="." method="on_child_entered_tree"]
